{"version":3,"file":"types.js","sourceRoot":"","sources":["../../src/config/types.ts"],"names":[],"mappings":";;;AA4JA,sCAiBC;AA7KD,8CAU6B;AA8HhB,QAAA,cAAc,GAAuI;IAChK,WAAW,EAAE,EAAE;IACf,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,aAAa;IACrD,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,IAAI,kDAAkD;IACtG,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,EAAE;IAC5C,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,KAAK,OAAO;IACnD,UAAU,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,KAAK,OAAO;IAC1D,cAAc,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,IAAI,QAAQ,EAAE,EAAE,CAAC;IAChF,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,KAAK,MAAM;IAC9C,cAAc,EAAE,IAAI;IACpB,oBAAoB,EAAE,IAAI;IAC1B,eAAe,EAAE,CAAC;IAClB,OAAO,EAAE,6BAAsB;IAC/B,QAAQ,EAAE,8BAAuB;IACjC,QAAQ,EAAE,2BAAoB;CAC/B,CAAC;AAKF,SAAgB,aAAa,CAAC,SAAwB,EAAE;IACtD,OAAO;QACL,GAAG,sBAAc;QACjB,GAAG,MAAM;QACT,OAAO,EAAE;YACP,GAAG,6BAAsB;YACzB,GAAG,MAAM,CAAC,OAAO;SAClB;QACD,QAAQ,EAAE;YACR,GAAG,8BAAuB;YAC1B,GAAG,MAAM,CAAC,QAAQ;SACnB;QACD,QAAQ,EAAE;YACR,GAAG,2BAAoB;YACvB,GAAG,MAAM,CAAC,QAAQ;SACnB;KACF,CAAC;AACJ,CAAC","sourcesContent":["import {\n  ServiceMetadataSubmission,\n  ErrorEvent,\n  PrivacyConfig,\n  SamplingConfig,\n  BatchConfig,\n  BeforeSendHook,\n  DEFAULT_PRIVACY_CONFIG,\n  DEFAULT_SAMPLING_CONFIG,\n  DEFAULT_BATCH_CONFIG,\n} from '@lattice.black/core';\n\n/**\n * Lattice plugin configuration interface\n *\n * Following industry best practices from Sentry, OpenTelemetry, and Segment:\n * - Privacy-first: PII not captured by default\n * - Configurable sampling to reduce data volume\n * - Event batching for performance\n * - beforeSend hooks for filtering/modifying events\n */\nexport interface LatticeConfig {\n  // Service Identity\n  /** Service name (auto-detected if not provided) */\n  serviceName?: string;\n  /** Environment (development, staging, production) */\n  environment?: string;\n\n  // API Connection\n  /** Lattice API endpoint URL */\n  apiEndpoint?: string;\n  /** API key for authentication */\n  apiKey?: string;\n\n  // Behavior\n  /** Enable/disable the plugin entirely */\n  enabled?: boolean;\n  /** Auto-submit metadata after analysis */\n  autoSubmit?: boolean;\n  /** Interval for auto-submit in milliseconds */\n  submitInterval?: number;\n  /** Enable debug logging */\n  debug?: boolean;\n\n  // Discovery Options\n  /** Discover Express routes */\n  discoverRoutes?: boolean;\n  /** Discover package.json dependencies */\n  discoverDependencies?: boolean;\n  /** Depth for dependency analysis */\n  dependencyDepth?: number;\n  /** Custom path to package.json */\n  packageJsonPath?: string;\n\n  // Privacy Settings (NEW)\n  /** Privacy configuration for controlling captured data */\n  privacy?: Partial<PrivacyConfig>;\n\n  // Sampling Settings (NEW)\n  /** Sampling configuration to control data volume */\n  sampling?: Partial<SamplingConfig>;\n\n  // Batching Settings (NEW)\n  /** Batching configuration for event submission */\n  batching?: Partial<BatchConfig>;\n\n  // Hooks (NEW)\n  /** Hook to filter/modify error events before sending */\n  beforeSendError?: BeforeSendHook<Partial<ErrorEvent>>;\n  /** Hook to filter/modify metric events before sending */\n  beforeSendMetric?: BeforeSendHook<RequestMetrics>;\n\n  // Callbacks\n  /** Called after metadata is analyzed */\n  onAnalyzed?: (metadata: ServiceMetadataSubmission) => void;\n  /** Called after successful submission */\n  onSubmitted?: (response: SubmissionResponse) => void;\n  /** Called when an error occurs */\n  onError?: (error: Error) => void;\n}\n\n/**\n * Submission response from collector API\n */\nexport interface SubmissionResponse {\n  success: boolean;\n  serviceId: string;\n  routesProcessed: number;\n  dependenciesProcessed: number;\n}\n\n/**\n * Request metrics data structure\n */\nexport interface RequestMetrics {\n  method: string;\n  path: string;\n  statusCode: number;\n  durationMs: number;\n  timestamp: Date;\n  serviceName: string;\n}\n\n/**\n * Resolved configuration with all defaults applied\n */\nexport interface ResolvedLatticeConfig {\n  serviceName: string;\n  environment: string;\n  apiEndpoint: string;\n  apiKey: string;\n  enabled: boolean;\n  autoSubmit: boolean;\n  submitInterval: number;\n  debug: boolean;\n  discoverRoutes: boolean;\n  discoverDependencies: boolean;\n  dependencyDepth: number;\n  packageJsonPath?: string;\n  privacy: PrivacyConfig;\n  sampling: SamplingConfig;\n  batching: BatchConfig;\n  beforeSendError?: BeforeSendHook<Partial<ErrorEvent>>;\n  beforeSendMetric?: BeforeSendHook<RequestMetrics>;\n  onAnalyzed?: (metadata: ServiceMetadataSubmission) => void;\n  onSubmitted?: (response: SubmissionResponse) => void;\n  onError?: (error: Error) => void;\n}\n\n/**\n * Default configuration values\n *\n * IMPORTANT: Privacy-first defaults\n * - Request body, headers, query params NOT captured by default\n * - All sampling rates default to 1.0 (capture all)\n */\nexport const DEFAULT_CONFIG: Omit<ResolvedLatticeConfig, 'beforeSendError' | 'beforeSendMetric' | 'onAnalyzed' | 'onSubmitted' | 'onError' | 'packageJsonPath'> = {\n  serviceName: '',\n  environment: process.env['NODE_ENV'] || 'development',\n  apiEndpoint: process.env['LATTICE_API_ENDPOINT'] || 'https://lattice-production.up.railway.app/api/v1',\n  apiKey: process.env['LATTICE_API_KEY'] || '',\n  enabled: process.env['LATTICE_ENABLED'] !== 'false',\n  autoSubmit: process.env['LATTICE_AUTO_SUBMIT'] !== 'false',\n  submitInterval: parseInt(process.env['LATTICE_SUBMIT_INTERVAL'] || '300000', 10),\n  debug: process.env['LATTICE_DEBUG'] === 'true',\n  discoverRoutes: true,\n  discoverDependencies: true,\n  dependencyDepth: 1,\n  privacy: DEFAULT_PRIVACY_CONFIG,\n  sampling: DEFAULT_SAMPLING_CONFIG,\n  batching: DEFAULT_BATCH_CONFIG,\n};\n\n/**\n * Resolve partial config with defaults\n */\nexport function resolveConfig(config: LatticeConfig = {}): ResolvedLatticeConfig {\n  return {\n    ...DEFAULT_CONFIG,\n    ...config,\n    privacy: {\n      ...DEFAULT_PRIVACY_CONFIG,\n      ...config.privacy,\n    },\n    sampling: {\n      ...DEFAULT_SAMPLING_CONFIG,\n      ...config.sampling,\n    },\n    batching: {\n      ...DEFAULT_BATCH_CONFIG,\n      ...config.batching,\n    },\n  };\n}\n"]}