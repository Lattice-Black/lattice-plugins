{"version":3,"file":"safe-wrapper.js","sourceRoot":"","sources":["../../src/utils/safe-wrapper.ts"],"names":[],"mappings":";;;AAgDA,wDAcC;AAMD,sDAcC;AAcD,8BAcC;AAKD,4BAcC;AAMD,oDAqBC;AAKD,0BAEC;AArJM,MAAM,mBAAmB,GAAiB,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE;IAClE,MAAM,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,kBAAkB,OAAO,GAAG,CAAC,CAAC,CAAC,eAAe,CAAC;IACxE,OAAO,CAAC,KAAK,CAAC,GAAG,MAAM,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;AAC9C,CAAC,CAAC;AAHW,QAAA,mBAAmB,uBAG9B;AA+BF,SAAgB,sBAAsB,CACpC,EAAwC,EACxC,EAAE,QAAQ,EAAE,OAAO,GAAG,2BAAmB,EAAE,OAAO,EAAE,SAAS,GAAG,IAAI,EAA+B;IAEnG,OAAO,KAAK,EAAE,GAAG,IAAW,EAAoB,EAAE;QAChD,IAAI,CAAC;YACH,OAAO,MAAM,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,SAAS,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;gBACxC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YAC1B,CAAC;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;IACH,CAAC,CAAC;AACJ,CAAC;AAMD,SAAgB,qBAAqB,CACnC,EAA+B,EAC/B,EAAE,QAAQ,EAAE,OAAO,GAAG,2BAAmB,EAAE,OAAO,EAAE,SAAS,GAAG,IAAI,EAA+B;IAEnG,OAAO,CAAC,GAAG,IAAW,EAAW,EAAE;QACjC,IAAI,CAAC;YACH,OAAO,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;QACrB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,SAAS,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;gBACxC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YAC1B,CAAC;YACD,OAAO,QAAQ,CAAC;QAClB,CAAC;IACH,CAAC,CAAC;AACJ,CAAC;AAcM,KAAK,UAAU,SAAS,CAC7B,EAAoB,EACpB,QAAW,EACX,OAAgB,EAChB,UAAwB,2BAAmB;IAE3C,IAAI,CAAC;QACH,OAAO,MAAM,EAAE,EAAE,CAAC;IACpB,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;YAC3B,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAC1B,CAAC;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;AACH,CAAC;AAKD,SAAgB,QAAQ,CACtB,EAAW,EACX,QAAW,EACX,OAAgB,EAChB,UAAwB,2BAAmB;IAE3C,IAAI,CAAC;QACH,OAAO,EAAE,EAAE,CAAC;IACd,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;YAC3B,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAC1B,CAAC;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;AACH,CAAC;AAMM,KAAK,UAAU,oBAAoB,CACxC,EAAoB,EACpB,QAAW,EACX,SAAiB,EACjB,OAAgB,EAChB,UAAwB,2BAAmB;IAE3C,IAAI,CAAC;QACH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC;YAChC,EAAE,EAAE;YACJ,IAAI,OAAO,CAAQ,CAAC,CAAC,EAAE,MAAM,EAAE,EAAE,CAC/B,UAAU,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,6BAA6B,SAAS,IAAI,CAAC,CAAC,EAAE,SAAS,CAAC,CAC3F;SACF,CAAC,CAAC;QACH,OAAO,MAAM,CAAC;IAChB,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;YAC3B,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAC1B,CAAC;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;AACH,CAAC;AAKD,SAAgB,OAAO,CAAC,KAAc;IACpC,OAAO,KAAK,YAAY,KAAK,CAAC;AAChC,CAAC","sourcesContent":["/**\n * Safe Wrapper Utilities\n *\n * Following OpenTelemetry and Sentry patterns:\n * - SDK operations should NEVER throw unhandled exceptions\n * - Failed operations return safe fallback values\n * - Errors are logged but don't crash the host application\n */\n\nexport type ErrorHandler = (error: Error, context?: string) => void;\n\n/**\n * Default error handler that logs to console\n */\nexport const defaultErrorHandler: ErrorHandler = (error, context) => {\n  const prefix = context ? `[Lattice SDK - ${context}]` : '[Lattice SDK]';\n  console.error(`${prefix} ${error.message}`);\n};\n\n/**\n * Options for safe wrapper functions\n */\nexport interface SafeWrapperOptions<T> {\n  /** Value to return if the operation fails */\n  fallback: T;\n  /** Error handler for logging/reporting */\n  onError?: ErrorHandler;\n  /** Context string for error messages */\n  context?: string;\n  /** Whether to log errors (default: true in non-production) */\n  logErrors?: boolean;\n}\n\n/**\n * Wraps an async function to never throw\n * Returns the fallback value on any error\n *\n * @example\n * ```typescript\n * const safeSubmit = createSafeAsyncWrapper(\n *   async (data) => await apiClient.submit(data),\n *   { fallback: null, context: 'submit' }\n * );\n *\n * // This will never throw, returns null on error\n * const result = await safeSubmit(someData);\n * ```\n */\nexport function createSafeAsyncWrapper<TArgs extends unknown[], TReturn>(\n  fn: (...args: TArgs) => Promise<TReturn>,\n  { fallback, onError = defaultErrorHandler, context, logErrors = true }: SafeWrapperOptions<TReturn>\n): (...args: TArgs) => Promise<TReturn> {\n  return async (...args: TArgs): Promise<TReturn> => {\n    try {\n      return await fn(...args);\n    } catch (error) {\n      if (logErrors && error instanceof Error) {\n        onError(error, context);\n      }\n      return fallback;\n    }\n  };\n}\n\n/**\n * Wraps a synchronous function to never throw\n * Returns the fallback value on any error\n */\nexport function createSafeSyncWrapper<TArgs extends unknown[], TReturn>(\n  fn: (...args: TArgs) => TReturn,\n  { fallback, onError = defaultErrorHandler, context, logErrors = true }: SafeWrapperOptions<TReturn>\n): (...args: TArgs) => TReturn {\n  return (...args: TArgs): TReturn => {\n    try {\n      return fn(...args);\n    } catch (error) {\n      if (logErrors && error instanceof Error) {\n        onError(error, context);\n      }\n      return fallback;\n    }\n  };\n}\n\n/**\n * Execute an async operation safely, returning the result or fallback\n *\n * @example\n * ```typescript\n * const result = await safeAsync(\n *   () => apiClient.submit(data),\n *   null,\n *   'submit'\n * );\n * ```\n */\nexport async function safeAsync<T>(\n  fn: () => Promise<T>,\n  fallback: T,\n  context?: string,\n  onError: ErrorHandler = defaultErrorHandler\n): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (error instanceof Error) {\n      onError(error, context);\n    }\n    return fallback;\n  }\n}\n\n/**\n * Execute a synchronous operation safely, returning the result or fallback\n */\nexport function safeSync<T>(\n  fn: () => T,\n  fallback: T,\n  context?: string,\n  onError: ErrorHandler = defaultErrorHandler\n): T {\n  try {\n    return fn();\n  } catch (error) {\n    if (error instanceof Error) {\n      onError(error, context);\n    }\n    return fallback;\n  }\n}\n\n/**\n * Execute an async operation with a timeout\n * Returns fallback if operation times out\n */\nexport async function safeAsyncWithTimeout<T>(\n  fn: () => Promise<T>,\n  fallback: T,\n  timeoutMs: number,\n  context?: string,\n  onError: ErrorHandler = defaultErrorHandler\n): Promise<T> {\n  try {\n    const result = await Promise.race([\n      fn(),\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error(`Operation timed out after ${timeoutMs}ms`)), timeoutMs)\n      ),\n    ]);\n    return result;\n  } catch (error) {\n    if (error instanceof Error) {\n      onError(error, context);\n    }\n    return fallback;\n  }\n}\n\n/**\n * Type guard to check if a value is an Error\n */\nexport function isError(value: unknown): value is Error {\n  return value instanceof Error;\n}\n"]}