{"version":3,"file":"api-client.js","sourceRoot":"","sources":["../../src/client/api-client.ts"],"names":[],"mappings":";;;AAAA,8CAAyG;AAOzG,MAAa,SAAS;IACZ,WAAW,CAAS;IACpB,MAAM,CAAS;IAEvB,YAAY,WAAmB,EAAE,MAAc;QAC7C,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QAClD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAKD,KAAK,CAAC,cAAc,CAAC,QAAmC;QACtD,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,WAAW,GAAG,oBAAa,CAAC,eAAe,EAAE,CAAC;QAElE,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;gBAChC,MAAM,EAAE,MAAM;gBACd,OAAO,EAAE;oBACP,cAAc,EAAE,kBAAkB;oBAClC,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC,mBAAY,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;oBAC3D,CAAC,mBAAY,CAAC,cAAc,CAAC,EAAE,OAAO;iBACvC;gBACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;aAC/B,CAAC,CAAC;YAEH,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;gBACjB,MAAM,SAAS,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACxC,MAAM,IAAI,KAAK,CACb,0BAA0B,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,UAAU,MAAM,SAAS,EAAE,CAClF,CAAC;YACJ,CAAC;YAED,MAAM,MAAM,GAAG,CAAC,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAuB,CAAC;YAC7D,OAAO,MAAM,CAAC;QAChB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,8BAA8B,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;YACjE,CAAC;YACD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAKD,KAAK,CAAC,WAAW;QACf,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,WAAW,GAAG,oBAAa,CAAC,MAAM,EAAE,CAAC;QAEzD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;gBAChC,MAAM,EAAE,KAAK;aACd,CAAC,CAAC;YAEH,OAAO,QAAQ,CAAC,EAAE,CAAC;QACrB,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IAKD,KAAK,CAAC,YAAY,CAAC,MAA6B;QAC9C,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,WAAW,eAAe,CAAC;QAE/C,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;gBAChC,MAAM,EAAE,MAAM;gBACd,OAAO,EAAE;oBACP,cAAc,EAAE,kBAAkB;oBAClC,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC,mBAAY,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;iBAC5D;gBACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,CAAC;aACjC,CAAC,CAAC;YAEH,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;gBACjB,MAAM,SAAS,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACxC,MAAM,IAAI,KAAK,CAAC,4BAA4B,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,UAAU,MAAM,SAAS,EAAE,CAAC,CAAC;YACvG,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,4BAA4B,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;YAC/D,CAAC;YACD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAKD,KAAK,CAAC,aAAa,CAAC,OAAkB;QACpC,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,WAAW,2BAA2B,CAAC;QAE3D,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;gBAChC,MAAM,EAAE,MAAM;gBACd,OAAO,EAAE;oBACP,cAAc,EAAE,kBAAkB;oBAClC,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC,mBAAY,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;iBAC5D;gBACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC;aAC1C,CAAC,CAAC;YAEH,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;gBACjB,MAAM,SAAS,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACxC,MAAM,IAAI,KAAK,CAAC,8BAA8B,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,UAAU,MAAM,SAAS,EAAE,CAAC,CAAC;YACzG,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,KAAK,EAAE,CAAC;gBAC3B,MAAM,IAAI,KAAK,CAAC,6BAA6B,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;YAChE,CAAC;YACD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;CACF;AAnHD,8BAmHC","sourcesContent":["import { ServiceMetadataSubmission, HTTP_HEADERS, API_ENDPOINTS, ErrorEvent } from '@lattice.black/core';\nimport { SubmissionResponse } from '../config/types';\nimport type { LatticeApiClient } from './noop-client';\n\n/**\n * API client for submitting metadata to Lattice collector\n */\nexport class ApiClient implements LatticeApiClient {\n  private apiEndpoint: string;\n  private apiKey: string;\n\n  constructor(apiEndpoint: string, apiKey: string) {\n    this.apiEndpoint = apiEndpoint.replace(/\\/$/, ''); // Remove trailing slash\n    this.apiKey = apiKey;\n  }\n\n  /**\n   * Submit service metadata to collector API\n   */\n  async submitMetadata(metadata: ServiceMetadataSubmission): Promise<SubmissionResponse> {\n    const url = `${this.apiEndpoint}${API_ENDPOINTS.INGEST_METADATA}`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(this.apiKey && { [HTTP_HEADERS.API_KEY]: this.apiKey }),\n          [HTTP_HEADERS.SCHEMA_VERSION]: '1.0.0',\n        },\n        body: JSON.stringify(metadata),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(\n          `API submission failed: ${response.status} ${response.statusText} - ${errorText}`\n        );\n      }\n\n      const result = (await response.json()) as SubmissionResponse;\n      return result;\n    } catch (error) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit metadata: ${error.message}`);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Health check to verify API connectivity\n   */\n  async healthCheck(): Promise<boolean> {\n    const url = `${this.apiEndpoint}${API_ENDPOINTS.HEALTH}`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'GET',\n      });\n\n      return response.ok;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Submit errors to collector API\n   */\n  async submitErrors(errors: Partial<ErrorEvent>[]): Promise<void> {\n    const url = `${this.apiEndpoint}/errors/batch`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(this.apiKey && { [HTTP_HEADERS.API_KEY]: this.apiKey }),\n        },\n        body: JSON.stringify({ errors }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Error submission failed: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n    } catch (error) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit errors: ${error.message}`);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Submit metrics to collector API\n   */\n  async submitMetrics(metrics: unknown[]): Promise<void> {\n    const url = `${this.apiEndpoint}/performance/traces/batch`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(this.apiKey && { [HTTP_HEADERS.API_KEY]: this.apiKey }),\n        },\n        body: JSON.stringify({ traces: metrics }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Metrics submission failed: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n    } catch (error) {\n      if (error instanceof Error) {\n        throw new Error(`Failed to submit metrics: ${error.message}`);\n      }\n      throw error;\n    }\n  }\n}\n"]}