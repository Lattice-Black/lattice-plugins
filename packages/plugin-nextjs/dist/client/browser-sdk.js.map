{"version":3,"file":"browser-sdk.js","sourceRoot":"","sources":["../../src/client/browser-sdk.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Browser-side Error Capture SDK for Next.js\n * Captures unhandled errors and sends them to Lattice API\n */\n\n'use client';\n\nimport { parse } from 'error-stack-parser-es';\nimport { BreadcrumbCategory, BreadcrumbLevel } from '@lattice.black/core';\nimport type { StackFrame, ErrorEvent, Breadcrumb } from '@lattice.black/core';\n\nexport interface LatticeMonitoringConfig {\n  apiEndpoint: string;\n  apiKey: string;\n  serviceName: string;\n  environment?: string;\n  captureUnhandledErrors?: boolean;\n  captureUnhandledRejections?: boolean;\n  captureBreadcrumbs?: boolean;\n  captureConsole?: boolean;\n  captureNavigation?: boolean;\n  captureClicks?: boolean;\n  maxBreadcrumbs?: number;\n  enabled?: boolean;\n}\n\ninterface ClientBreadcrumb {\n  session_id: string;\n  category: BreadcrumbCategory;\n  message: string;\n  level: BreadcrumbLevel;\n  data?: Record<string, any>;\n  timestamp: Date;\n}\n\nlet config: LatticeMonitoringConfig | null = null;\nlet sessionId: string | null = null;\nlet breadcrumbs: ClientBreadcrumb[] = [];\nconst MAX_BREADCRUMBS_DEFAULT = 100;\n\n/**\n * Initialize Lattice monitoring\n */\nexport function initLatticeMonitoring(userConfig: LatticeMonitoringConfig): void {\n  config = {\n    ...userConfig,\n    environment: userConfig.environment || process.env.NODE_ENV || 'development',\n    captureUnhandledErrors: userConfig.captureUnhandledErrors !== false,\n    captureUnhandledRejections: userConfig.captureUnhandledRejections !== false,\n    captureBreadcrumbs: userConfig.captureBreadcrumbs !== false,\n    captureConsole: userConfig.captureConsole !== false,\n    captureNavigation: userConfig.captureNavigation !== false,\n    captureClicks: userConfig.captureClicks !== false,\n    maxBreadcrumbs: userConfig.maxBreadcrumbs || MAX_BREADCRUMBS_DEFAULT,\n    enabled: userConfig.enabled !== false,\n  };\n\n  if (!config.enabled) {\n    return;\n  }\n\n  // Generate or restore session ID\n  sessionId = getOrCreateSessionId();\n\n  // Initialize breadcrumbs\n  if (config.captureBreadcrumbs) {\n    setupBreadcrumbCapture();\n  }\n\n  // Capture unhandled errors\n  if (config.captureUnhandledErrors) {\n    window.addEventListener('error', handleGlobalError);\n  }\n\n  // Capture unhandled promise rejections\n  if (config.captureUnhandledRejections) {\n    window.addEventListener('unhandledrejection', handleUnhandledRejection);\n  }\n\n  console.log(`[Lattice] Monitoring initialized for ${config.serviceName}`);\n}\n\n/**\n * Manually capture an error\n */\nexport function captureError(\n  error: Error,\n  context?: Record<string, any>\n): void {\n  if (!config || !config.enabled) {\n    return;\n  }\n\n  // Add error breadcrumb\n  addBreadcrumb(BreadcrumbCategory.Custom, error.message, BreadcrumbLevel.Error, {\n    name: error.name,\n    errorType: 'error',\n    ...context,\n  });\n\n  const stackFrames = parseStackTrace(error);\n\n  const errorEvent: Partial<ErrorEvent> = {\n    service_id: config.serviceName,\n    environment: config.environment as 'development' | 'staging' | 'production',\n    error_type: error.name || 'Error',\n    message: error.message || 'Unknown error',\n    stack_trace: stackFrames,\n    context,\n    session_id: sessionId || undefined,\n    timestamp: new Date(),\n  };\n\n  // Send error with breadcrumbs\n  Promise.all([\n    sendToAPI(errorEvent),\n    sendBreadcrumbs(getBreadcrumbs()),\n  ]).catch(err => {\n    console.error('[Lattice] Failed to send error:', err);\n  });\n}\n\n/**\n * Handle window.onerror events\n */\nfunction handleGlobalError(event: globalThis.ErrorEvent): void {\n  if (!config) return;\n\n  const error = event.error || new Error(event.message);\n  captureError(error, {\n    filename: event.filename,\n    lineno: event.lineno,\n    colno: event.colno,\n    type: 'unhandled_error',\n  });\n}\n\n/**\n * Handle unhandledrejection events\n */\nfunction handleUnhandledRejection(event: PromiseRejectionEvent): void {\n  if (!config) return;\n\n  const error = event.reason instanceof Error\n    ? event.reason\n    : new Error(String(event.reason));\n\n  captureError(error, {\n    type: 'unhandled_rejection',\n    reason: event.reason,\n  });\n}\n\n/**\n * Parse error stack trace\n */\nfunction parseStackTrace(error: Error): StackFrame[] {\n  try {\n    const frames = parse(error);\n\n    return frames.map(frame => ({\n      filename: frame.fileName || 'unknown',\n      line_number: frame.lineNumber || 0,\n      column_number: frame.columnNumber,\n      function_name: frame.functionName || '<anonymous>',\n    }));\n  } catch (err) {\n    return [{\n      filename: 'unknown',\n      line_number: 0,\n      function_name: error.name || 'Error',\n    }];\n  }\n}\n\n/**\n * Send error event to Lattice API\n */\nasync function sendToAPI(errorEvent: Partial<ErrorEvent>): Promise<void> {\n  if (!config) return;\n\n  try {\n    const response = await fetch(`${config.apiEndpoint}/errors`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Lattice-API-Key': config.apiKey,\n      },\n      body: JSON.stringify(errorEvent),\n    });\n\n    if (!response.ok) {\n      console.error(\n        `[Lattice] Failed to send error: ${response.status} ${response.statusText}`\n      );\n    }\n  } catch (err) {\n    // Fail silently to avoid error loops\n    console.error('[Lattice] Network error:', err);\n  }\n}\n\n/**\n * Get or create session ID\n */\nfunction getOrCreateSessionId(): string {\n  if (typeof window === 'undefined') {\n    return '';\n  }\n\n  try {\n    let id = sessionStorage.getItem('lattice_session_id');\n\n    if (!id) {\n      // Generate ULID-like ID (timestamp + random)\n      const timestamp = Date.now().toString(36);\n      const random = Math.random().toString(36).substring(2, 15);\n      id = `${timestamp}-${random}`;\n      sessionStorage.setItem('lattice_session_id', id);\n    }\n\n    return id;\n  } catch (err) {\n    // SessionStorage might not be available\n    return `temp-${Date.now()}`;\n  }\n}\n\n/**\n * Manually add a breadcrumb\n */\nexport function addBreadcrumb(\n  category: BreadcrumbCategory,\n  message: string,\n  level: BreadcrumbLevel = BreadcrumbLevel.Info,\n  data?: Record<string, any>\n): void {\n  if (!config || !config.enabled || !config.captureBreadcrumbs) {\n    return;\n  }\n\n  const breadcrumb: ClientBreadcrumb = {\n    session_id: sessionId || '',\n    category,\n    message,\n    level,\n    data,\n    timestamp: new Date(),\n  };\n\n  breadcrumbs.push(breadcrumb);\n\n  // Keep only last N breadcrumbs\n  const maxBreadcrumbs = config.maxBreadcrumbs || MAX_BREADCRUMBS_DEFAULT;\n  if (breadcrumbs.length > maxBreadcrumbs) {\n    breadcrumbs.shift();\n  }\n}\n\n/**\n * Get current breadcrumbs\n */\nexport function getBreadcrumbs(): ClientBreadcrumb[] {\n  return [...breadcrumbs];\n}\n\n/**\n * Clear breadcrumbs\n */\nexport function clearBreadcrumbs(): void {\n  breadcrumbs = [];\n}\n\n/**\n * Setup automatic breadcrumb capture\n */\nfunction setupBreadcrumbCapture(): void {\n  if (!config) return;\n\n  // Capture console logs\n  if (config.captureConsole) {\n    instrumentConsole();\n  }\n\n  // Capture navigation\n  if (config.captureNavigation) {\n    instrumentNavigation();\n  }\n\n  // Capture clicks\n  if (config.captureClicks) {\n    instrumentClicks();\n  }\n}\n\n/**\n * Instrument console methods\n */\nfunction instrumentConsole(): void {\n  const originalConsole = {\n    log: console.log,\n    warn: console.warn,\n    error: console.error,\n    info: console.info,\n  };\n\n  console.log = (...args: any[]) => {\n    addBreadcrumb(BreadcrumbCategory.Console, args.join(' '), BreadcrumbLevel.Info);\n    originalConsole.log(...args);\n  };\n\n  console.warn = (...args: any[]) => {\n    addBreadcrumb(BreadcrumbCategory.Console, args.join(' '), BreadcrumbLevel.Warning);\n    originalConsole.warn(...args);\n  };\n\n  console.error = (...args: any[]) => {\n    addBreadcrumb(BreadcrumbCategory.Console, args.join(' '), BreadcrumbLevel.Error);\n    originalConsole.error(...args);\n  };\n\n  console.info = (...args: any[]) => {\n    addBreadcrumb(BreadcrumbCategory.Console, args.join(' '), BreadcrumbLevel.Info);\n    originalConsole.info(...args);\n  };\n}\n\n/**\n * Instrument navigation events\n */\nfunction instrumentNavigation(): void {\n  // Capture page loads\n  addBreadcrumb(BreadcrumbCategory.Navigation, `Page loaded: ${window.location.href}`, BreadcrumbLevel.Info);\n\n  // Capture history changes (SPA navigation)\n  const originalPushState = history.pushState;\n  const originalReplaceState = history.replaceState;\n\n  history.pushState = function (...args: any[]) {\n    addBreadcrumb(BreadcrumbCategory.Navigation, `Navigated to: ${args[2] || window.location.href}`, BreadcrumbLevel.Info);\n    return originalPushState.apply(this, args as any);\n  };\n\n  history.replaceState = function (...args: any[]) {\n    addBreadcrumb(BreadcrumbCategory.Navigation, `Replaced state: ${args[2] || window.location.href}`, BreadcrumbLevel.Info);\n    return originalReplaceState.apply(this, args as any);\n  };\n\n  // Capture popstate (back/forward)\n  window.addEventListener('popstate', () => {\n    addBreadcrumb(BreadcrumbCategory.Navigation, `Back/Forward to: ${window.location.href}`, BreadcrumbLevel.Info);\n  });\n}\n\n/**\n * Instrument click events\n */\nfunction instrumentClicks(): void {\n  document.addEventListener('click', (event: MouseEvent) => {\n    const target = event.target as HTMLElement;\n    const tagName = target.tagName.toLowerCase();\n    let message = `Clicked ${tagName}`;\n\n    // Add more context for specific elements\n    if (tagName === 'button') {\n      message += target.textContent ? `: ${target.textContent.trim().substring(0, 50)}` : '';\n    } else if (tagName === 'a') {\n      const href = (target as HTMLAnchorElement).href;\n      message += href ? `: ${href}` : '';\n    } else if (target.id) {\n      message += `#${target.id}`;\n    } else if (target.className) {\n      message += `.${target.className.split(' ')[0]}`;\n    }\n\n    addBreadcrumb(BreadcrumbCategory.UserAction, message, BreadcrumbLevel.Info, {\n      tagName,\n      id: target.id || undefined,\n      className: target.className || undefined,\n    });\n  }, true); // Use capture phase\n}\n\n/**\n * Send breadcrumbs to API\n */\nasync function sendBreadcrumbs(breadcrumbsToSend: ClientBreadcrumb[]): Promise<void> {\n  if (!config || breadcrumbsToSend.length === 0) return;\n\n  try {\n    const response = await fetch(`${config.apiEndpoint}/breadcrumbs`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Lattice-API-Key': config.apiKey,\n      },\n      body: JSON.stringify({ breadcrumbs: breadcrumbsToSend }),\n    });\n\n    if (!response.ok) {\n      console.error(\n        `[Lattice] Failed to send breadcrumbs: ${response.status} ${response.statusText}`\n      );\n    }\n  } catch (err) {\n    // Fail silently\n    console.error('[Lattice] Network error sending breadcrumbs:', err);\n  }\n}\n"]}